<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Faster-than-Light memes</title>
  <link href="https://benjamin-asdf.github.io/faster-than-light-memes/atom.xml" rel="self"/>
  <link href="https://benjamin-asdf.github.io/faster-than-light-memes/"/>
  <updated>2022-10-05T13:15:47+00:00</updated>
  <id>https://benjamin-asdf.github.io/faster-than-light-memes/</id>
  <author>
    <name>Benjamin Schwerdtner</name>
  </author>
  <entry>
    <id>https://benjamin-asdf.github.io/faster-than-light-memes/scittle-prints-itself.html</id>
    <link href="https://benjamin-asdf.github.io/faster-than-light-memes/scittle-prints-itself.html"/>
    <title>scittle-prints-itself</title>
    <updated>2022-09-26T23:59:59+00:00</updated>
    <content type="html">
      <![CDATA[<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>scittle-prints-itself</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">scittle-prints-itself</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org232bac3">Introduction</a></li>
<li><a href="#orgf71fef5">Problem statement</a></li>
<li><a href="#org7ecae6f">Some reagent code</a></li>
<li><a href="#org1bc88aa">Fetch</a></li>
<li><a href="#orgb92ca61">Pretty print the code..?</a></li>
<li><a href="#org97239ad">Eval string</a></li>
<li><a href="#orga4f349b">Only fetch once</a></li>
<li><a href="#org579a4a7">Make a big aquamarine rectangle into a small magenta rectangle</a></li>
<li><a href="#org87ce17f">Codepen</a></li>
</ul>
</div>
</div>
<p>
Description of the crafting of a website.
Up <a href="https://benjamin-asdf.github.io/scittle-prints-itself/">here</a>.
</p>

<div id="outline-container-org232bac3" class="outline-2">
<h2 id="org232bac3">Introduction</h2>
<div class="outline-text-2" id="text-org232bac3">
<p>
I was wondering about what is cool for a newcomer to coding.
I love lisp and I think one of the real joys in programming is interactive programming.
So if I find some way of communicating this magic, that would be great.
</p>

<p>
After my <a href="binaural-beats-using-scittle.html">binaural beats</a> adventure I feel like Scittle is an amazing tool
so I want to try it on something bigger.
So I had this idea of a Scittle website that prints its source code,
then you update the code and get an immediate effect.
</p>

<p>
I wanted this to be <b>my</b> website so maybe a new team member can also
go into the code and hack around.
</p>
</div>
</div>

<div id="outline-container-orgf71fef5" class="outline-2">
<h2 id="orgf71fef5">Problem statement</h2>
<div class="outline-text-2" id="text-orgf71fef5">
<ol class="org-ol">
<li>print your source code</li>
<li>ability to update code</li>
<li>no code editor in the browser (input field&#x2026;)
I am thinking getting this approximately non-clunky would be hard.
Especially balancing the parens.
I decided to go with a drag and drop area where you slurp in a
file into the browser.</li>
<li>This is not a <a href="https://en.wikipedia.org/wiki/Quine_(computing)">Quine</a> because it receives the source code as input</li>
</ol>
</div>
</div>

<div id="outline-container-org7ecae6f" class="outline-2">
<h2 id="org7ecae6f">Some reagent code</h2>
<div class="outline-text-2" id="text-org7ecae6f">
<p>
I do some StackOverflow-driven development for a drag-and-drop area.
</p>

<p>
I needed to figure out how <a href="https://www.w3schools.com/jsref/event_ondragover.asp">ondragover Event</a> and friends translate with
hiccup.
Luckily the legendary question answerer  <code>@p-himik</code> helped me out in the
<code>#clojurescript</code> slack channel.
Turns out that when I add <code>:on-drag-over</code> in the attribute map it works.
</p>

<div class="org-src-container">
<pre class="src src-clojure">(ns main
  (:require
   [reagent.core :as r]
   [reagent.dom :as rdom]))

(defonce state (r/atom {:code-text ""}))

(defn drop-area []
  [:div#drop-area
   {:style {:margin-top "1rem"
	    :height "10rem"
	    :width "10rem"
	    :background "Aquamarine"}
    :on-drag-enter
    (fn [event]
      (set! (.. (js/document.getElementById "drop-area") -style -background) "cyan"))
    :on-drag-exit
    (fn [event]
      (set! (.. (js/document.getElementById "drop-area") -style -background) "Aquamarine"))
    :on-drag-over
    (fn [event]
      (doto
	  event
	  .stopPropagation
	 .preventDefault)
      (set! (.. event -dataTransfer -dropEffect) "copy"))
    :on-drop (fn [event]
      (doto
	  event
	  .stopPropagation
	  .preventDefault)
      (let [file (-&gt;  (.. event -dataTransfer -files) first)]
	(-&gt;
	 (.text file)
	 (.then
	  (fn [t] (swap! state assoc :code-text t)))))
      (set! (.. (js/document.getElementById "drop-area") -style -background) "Aquamarine"))}
   [:div
    {:style {:margin "1rem"
	     :padding-top "2.5rem"}}
    "drop a file here"]])

(defn code-snippet []
  [:div
   {:style {:background "gainsboro"}}
   (:code-text @state)])

(defn my-component []
  [:div
   [drop-area]
   [code-snippet]])

(rdom/render [my-component] (.getElementById js/document "app"))

(comment
  (swap! state assoc :code-text "foi110"))
</pre>
</div>

<p>
With this, I have a drop area for a file.
</p>

<p>
Wonderful thing:
Updating <code>state</code> redraws the UI for us.
</p>

<p>
Evaluating <code>(swap! state assoc :code-text "foi110")</code> makes <code>reagent</code> 's magic take effect.
</p>
</div>
</div>

<div id="outline-container-org1bc88aa" class="outline-2">
<h2 id="org1bc88aa">Fetch</h2>
<div class="outline-text-2" id="text-org1bc88aa">
<p>
I also want to show the default code on the first load.
After some StackOverflow research, I determine <a href="https://www.w3schools.com/jsref/api_fetch.asp">fetch</a> should work.
</p>

<div class="org-src-container">
<pre class="src src-clojure">(-&gt;
 (js/fetch "main.cljs")
 (.then (fn [x] (.text x)))
 (.then (fn [x] (swap! state assoc :code-text x))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb92ca61" class="outline-2">
<h2 id="orgb92ca61">Pretty print the code..?</h2>
<div class="outline-text-2" id="text-orgb92ca61">
<p>
At this point my website looks like this:
</p>


<div id="org81650be" class="figure">
<p><img src="https://i.imgur.com/VU5LqMM.png" alt="VU5LqMM.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Halfway there. Sort of printing the source code now.</p>
</div>

<p>
I want to do something where at least the white space is rendered.
</p>

<p>
After searching the web, I decide I need a <code>&lt;pre&gt;</code> tag to say it is preformatted.
Also <code>&lt;code&gt;</code> sounds great.
</p>

<div class="org-src-container">
<pre class="src src-clojure">(defn code-snippet []
  [:div
   {:style {:background "gainsboro"}}
   [:pre
    [:code
     (:code-text @state)]]])
</pre>
</div>

<p>
Update the function, re-eval the <code>rdom/render</code> form. Boom I instantly look at my updated visuals.
With cider, I can also call <code>cider-eval-buffer</code>, or <code>cider-eval-file</code>.
I first had the background <code>style</code> inside the <code>code</code> tag, which did not have
the look I wanted.
I can hack on a piece of UI in isolation. Directly. Without any mental
suspension time. It is great.
It is how all coding should be.
</p>
</div>
</div>

<div id="outline-container-org97239ad" class="outline-2">
<h2 id="org97239ad">Eval string</h2>
<div class="outline-text-2" id="text-org97239ad">
<p>
Now for the magic of updating the website with whatever you upload.
First, I ask Borkdude on slack how to evaluate a string.
-&gt; You use <code>load-string</code>.
</p>

<div class="org-src-container">
<pre class="src src-clojure">(load-string
 (prn-str '(js/console.log "hello")))
</pre>
</div>

<p>
Says <code>hello</code> in the console.
</p>

<p>
I update my file drop handler with the side effect of loading the text:
</p>

<div class="org-src-container">
<pre class="src src-clojure">(fn [t]
 (load-string l)
 (swap! state assoc :code-text t))
</pre>
</div>
<p>
(Yes there is a syntax error in this snippet).
</p>

<p>
I add this to the bottom of the file to see if my code is evaluated:
</p>

<div class="org-src-container">
<pre class="src src-clojure">(js/console.log "hello2")
</pre>
</div>

<p>
Now loading silently fails when I upload my file, but the text updates.
</p>

<p>
So I evaluate this in isolation:
</p>

<div class="org-src-container">
<pre class="src src-clojure">(load-string (@state :code-text))
</pre>
</div>

<p>
Ah, I get an analyzer error about <code>l</code> not being defined or something.
</p>

<p>
I update my handler like this:
</p>

<div class="org-src-container">
<pre class="src src-clojure">(try
 (load-string t)
 (swap! state assoc :code-text t)
 (catch js/Error _ (js/alert "That code does not work.")))
</pre>
</div>

<p>
following Stew Halloway's example of binary error feedback. Either
there is an error, or there is no error.
Error messages are just bloat anyway.
</p>

<p>
console says:
</p>

<blockquote>
<p>
hello2
</p>
</blockquote>

<p>
Another piece in place, another hit of dopamine, wonderful coding moments.
</p>
</div>
</div>

<div id="outline-container-orga4f349b" class="outline-2">
<h2 id="orga4f349b">Only fetch once</h2>
<div class="outline-text-2" id="text-orga4f349b">
<p>
I update the fetch code like so:
</p>

<div class="org-src-container">
<pre class="src src-clojure">(or
 (:code-text @state)
 (-&gt;
  (js/fetch "main.cljs")
  (.then (fn [x] (.text x)))
  (.then (fn [x] (swap! state assoc :code-text x)))))
</pre>
</div>

<p>
I can do this because in Clojure everything is an expression and I can
put expressions anywhere.
</p>
</div>
</div>

<div id="outline-container-org579a4a7" class="outline-2">
<h2 id="org579a4a7">Make a big aquamarine rectangle into a small magenta rectangle</h2>
<div class="outline-text-2" id="text-org579a4a7">
<p>
I want something on the eyes so I change the style of the drop area:
</p>

<div class="org-src-container">
<pre class="src src-clojure">{:margin-top "1rem"
 :height "5rem"
 :width "5rem"
 :background "magenta"}
</pre>
</div>


<p>
Drag and drop, and:
</p>


<div id="orgd998c36" class="figure">
<p><img src="https://i.imgur.com/IUrSY7t.png" alt="IUrSY7t.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Visuals updated via dragging and dropping a source file.</p>
</div>

<p>
In emacs: <code>list-colors-display</code>, nice. And drag and drop with <a href="https://github.com/mwh/dragon">dragon.</a>
</p>

<p>
This contraption of course pales in comparison to having a REPL running.
But the idea is that it is might useful to somebody that doesn't even
know what a REPL <b><b>is</b></b>.
And if you are a beginner and now you wonder what that REPL thing is.
<a href="intro-to-clojure.html">Here</a> I try to make a list of how to get a dev setup.
</p>

<p>
Here is an idea I had and did not put into the initial version: Make
an <code>undo</code> button. So that the user can go back in the history of the website
</p>
</div>
</div>

<div id="outline-container-org87ce17f" class="outline-2">
<h2 id="org87ce17f">Codepen</h2>
<div class="outline-text-2" id="text-org87ce17f">
<p>
An arguably more mature version of this is up on <a href="https://codepen.io/Prestance/pen/PoOdZQw">codepen</a>.
</p>

<p>
A key difference is that my website prints its whole code.
No machinery is hidden anywhere.
</p>

<p>
If I may say so I think this is cute.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-09-26 Mon 13:21</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2)</p>
</div>
</body>
</html>
]]>
    </content>
  </entry>
  <entry>
    <id>https://benjamin-asdf.github.io/faster-than-light-memes/anonymous-commands-in-emacs.html</id>
    <link href="https://benjamin-asdf.github.io/faster-than-light-memes/anonymous-commands-in-emacs.html"/>
    <title>anonymous-commands-in-emacs</title>
    <updated>2022-09-23T23:59:59+00:00</updated>
    <content type="html">
      <![CDATA[<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>anonymous-commands-in-emacs</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">anonymous-commands-in-emacs</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd36571f">Introduction</a>
<ul>
<li><a href="#org25bc655">add-hook</a></li>
</ul>
</li>
<li><a href="#orgd7cd24c">Solution</a>
<ul>
<li><a href="#orgd2fee9d">defun</a></li>
</ul>
</li>
<li><a href="#orgdd699bf">Result</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgd36571f" class="outline-2">
<h2 id="orgd36571f">Introduction</h2>
<div class="outline-text-2" id="text-orgd36571f">
<p>
Generally, you do not want to make keybindings to anonymous lambdas.
Here is the primary reason that comes to mind:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(describe-keymap
 (<span style="font-weight: bold;">let</span> ((m (make-sparse-keymap)))
   (define-key m (kbd <span style="font-style: italic;">"f"</span>) (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>) 'hi))
   m))
</pre>
</div>

<p>
I get help buffer with this content:
</p>

<pre class="example" id="org63384b8">
Key             Binding
f		[closure]
</pre>

<p>
It is not really useful to just get the info [closure] here.
</p>
</div>

<div id="outline-container-org25bc655" class="outline-3">
<h3 id="org25bc655">add-hook</h3>
<div class="outline-text-3" id="text-org25bc655">
<p>
The same thing goes for <code>add-hook</code>. From the doc string:
</p>

<blockquote>
<p>
FUNCTION may be any valid function, but it's recommended to use a
function symbol and not a lambda form.  Using a symbol will
ensure that the function is not re-added if the function is
edited, and using lambda forms may also have a negative
performance impact when running `add-hook' and `remove-hook'
</p>
</blockquote>

<p>
Some of the hooks functionality is meant for symbols.
</p>
</div>
</div>
</div>


<div id="outline-container-orgd7cd24c" class="outline-2">
<h2 id="orgd7cd24c">Solution</h2>
<div class="outline-text-2" id="text-orgd7cd24c">
<p>
Alias your function:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">foo-a</span> (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>) 'hi))
 (describe-keymap
  (<span style="font-weight: bold;">let</span> ((m (make-sparse-keymap)))
    (define-key m (kbd <span style="font-style: italic;">"f"</span>) 'foo-a)
    (define-key m (kbd <span style="font-style: italic;">"b"</span>) (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">foo-b</span> (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>) 'hi2)))
   m))
</pre>
</div>

<pre class="example" id="org9d6c811">
Key             Binding
b		foo-b
f		foo-a
</pre>


<p>
Foo-b works because <code>defalias</code> returns the symbol.
</p>
</div>

<div id="outline-container-orgd2fee9d" class="outline-3">
<h3 id="orgd2fee9d">defun</h3>
<div class="outline-text-3" id="text-orgd2fee9d">
<p>
<code>(defalias 'foo (lambda () (interactive)))</code>
</p>

<p>
is essentially the same as
</p>

<p>
<code>(defun foo () (interactive))</code>
</p>
</div>
</div>
</div>

<div id="outline-container-orgdd699bf" class="outline-2">
<h2 id="orgdd699bf">Result</h2>
<div class="outline-text-2" id="text-orgdd699bf">
<p>
I end up just using  <code>defun</code> inline.
Examples:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(add-hook
 'sh-mode-hook
 (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mm/add-bash-completion</span> () ...))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-elisp">(mememacs/leader-def
  <span style="font-style: italic;">"pP"</span> (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mm/project-switch-project-find-file</span> ()
         (<span style="font-weight: bold;">interactive</span>) ...))
</pre>
</div>

<p>
After writing this post, <a href="https://github.com/benjamin-asdf/dotfiles/commit/1e4135b977a5866de19020ba6f8a92b417339157">I went and fixed the remaining add-hook lambas</a> In my config.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-09-23 Fri 18:59</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2)</p>
</div>
</body>
</html>
]]>
    </content>
  </entry>
  <entry>
    <id>https://benjamin-asdf.github.io/faster-than-light-memes/bashing-is-better-than-extending.html</id>
    <link href="https://benjamin-asdf.github.io/faster-than-light-memes/bashing-is-better-than-extending.html"/>
    <title>Bashing is better than extending</title>
    <updated>2022-09-22T23:59:59+00:00</updated>
    <content type="html">
      <![CDATA[<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bashing is better than extending</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">Bashing is better than extending</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgce23f5d">Introduction</a></li>
<li><a href="#orgb51e1aa">Emacs in a magic forest</a></li>
<li><a href="#org189e411">read-shell-command</a></li>
<li><a href="#org471894b">bash-completion</a></li>
<li><a href="#org1080f14">bash completions are now your lever</a>
<ul>
<li><a href="#org9dd7195">Babashka tasks</a></li>
</ul>
</li>
<li><a href="#org9bd9f8a">Commands that leverage <code>read-shell-command</code></a>
<ul>
<li><a href="#orgf48fa76">shell-command</a>
<ul>
<li><a href="#org9989cce">Here is a nugget:</a></li>
<li><a href="#orgddedf8f">Good to know:</a></li>
<li><a href="#org54de924">Output buffer</a></li>
</ul>
</li>
<li><a href="#orgbde0a54">shell-command-async</a></li>
<li><a href="#org744478d">compile</a></li>
<li><a href="#orgc5c63de">dired</a></li>
<li><a href="#orgfbcf05c">shell-command-on-file</a></li>
</ul>
</li>
<li><a href="#org963a79f">It gets even better</a>
<ul>
<li><a href="#org7968ce3">revert-buffer in compilation buffers</a></li>
</ul>
</li>
<li><a href="#org64cab9a">Scripts at the speed of thought</a>
<ul>
<li><a href="#orgf48b317">mememacs/create-script</a>
<ul>
<li><a href="#orgbbc8693">bash-completion in <code>sh-mode</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge25b595">async-shell-command, my bread and butter</a>
<ul>
<li><a href="#orga93ede5">Put the command into the buffer name</a></li>
<li><a href="#org8a91817">shell-command&#x2013;same-buffer-confirm</a></li>
<li><a href="#org26ed96c">shell-mode as a terminal emulator</a></li>
</ul>
</li>
<li><a href="#org0989d1c">process-list</a></li>
<li><a href="#org66ffacd">The next layer on the cake</a>
<ul>
<li><a href="#org5b91295">project</a></li>
<li><a href="#org5a4a514">recompile</a></li>
<li><a href="#org105944e">ansi colors for comint</a></li>
</ul>
</li>
<li><a href="#orgc50e828">Levers are great</a>
<ul>
<li><a href="#orgab6be3f">ssh</a></li>
<li><a href="#org09ecc54">embarking</a></li>
<li><a href="#org485419e">pass</a></li>
</ul>
</li>
<li><a href="#org5dd7d30">Particulars</a>
<ul>
<li><a href="#orgd858532">shell-file-name</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<b>Not</b> how to run babashka tasks.
</p>

<p>
How <code>bash-completion</code>  makes everything better.
</p>

<p>
How to run <b>any</b> shell commands.
</p>

<p>
Technology around <code>shell-command</code>.
</p>

<p>
Simplicity and joy.
</p>

<div id="outline-container-orgce23f5d" class="outline-2">
<h2 id="orgce23f5d">Introduction</h2>
<div class="outline-text-2" id="text-orgce23f5d">
<p>
Ok, let's just do it. You might want to hold tight to your chair because
the juiciness and elegance of what follow might just blow you over.
Here is how I build my <a href="https://benjamin-asdf.github.io/faster-than-light-memes/">blog</a> with babashka tasks:
</p>


<div id="orgb657ec5" class="figure">
<p><img src="https://github.com/benjamin-asdf/faster-than-light-memes/blob/master/assets/bb-task-demo.gif?raw=true" alt="bb-task-demo.gif?raw=true" />
</p>
<p><span class="figure-number">Figure 1: </span>Using <code>compile</code> to leverage <code>read-shell-command</code> and thereby <code>bash-completions</code>. Recompiling via <code>revert-buffer</code>. Dismissing the <code>*compilation*</code> buffer.</p>
</div>

<p>
You might think "Ok sure, looks useful." Let me entice you with the
the really impressive thing about this:
</p>

<p>
There is nothing concrete about babashka tasks nor about that specific
project in my emacs config.
It just works by having a <code>bb.edn</code> with tasks.
</p>

<p>
Made possible via the harmony between some 3 or 4 general tools.
Like layers of ice. You deserve some skates to ride on
it. Smoothly, gracefully and <b>fast</b>.
Here is the story of a happy little package called <code>bash-completion</code>.
</p>
</div>
</div>

<div id="outline-container-orgb51e1aa" class="outline-2">
<h2 id="orgb51e1aa">Emacs in a magic forest</h2>
<div class="outline-text-2" id="text-orgb51e1aa">
<p>
Once upon a time,
</p>

<p>
there was an elven city on a big tree called Emacs in a magic forest.
They crafted all kinds of beautiful spells, some of them woven into
the fabric of the big forest itself.
</p>

<p>
A spell was crafted by writing in a magic book.
The language in the books was extremely pithy and made heavy use of parenthesis.
</p>

<p>
The city was overflowing with books. Even though the elves had
mastered the technology of infinite storage space, it was considered bad style to
produce more books as was necessary.
There were little books everywhere that talked about every corner of the forest.
Every time an elf wanted to craft a spell that had an effect somewhere
else in the forest, they would make a spell that talked to the river
and roots (called <code>shell</code> for some reason) in a language of <code>commands</code>.
</p>

<p>
The elves especially treasured their books <code>orderless</code>, <code>vetico</code> and
<code>consult</code>, though anything that made <code>completing-read</code> beautiful and
effective worked (<code>helm</code>, <code>ivy</code>, <code>selectrum</code>).
</p>

<p>
All elves knew well how to select <code>candidates</code> <b>fast</b>.
So it became really useful to be good at <code>completing-read</code>.
</p>

<p>
One day a hacker elf had an idea for a clever <a href="https://github.com/szermatt/emacs-bash-completion">book</a>.
A spell that would ask the <code>shell</code> for a list of <b><b>candidates of commands</b></b>
By doing so they enabled all <code>commands</code> to be part
of the beautiful dance of emacs, without the need for any more books.
No matter how large the forest grew, a single book would suffice to
make magic in <b>all</b> its corners <b>fast</b>.
</p>
</div>
</div>

<div id="outline-container-org189e411" class="outline-2">
<h2 id="org189e411">read-shell-command</h2>
<div class="outline-text-2" id="text-org189e411">
<p>
This is like <code>read-from-minibuffer</code> but sets some keymap and history.
Hit <code>&lt;tab&gt;</code>, you get completions from <code>shell-dynamic-complete-functions</code>.
Those completions are sort of okay, but they do not give you command-specific completions.
Invoke <code>shell-command</code>, then type <code>git checkout</code>, hit tab. Nothing happens. <b><b>Yet</b></b>.
</p>
</div>
</div>

<div id="outline-container-org471894b" class="outline-2">
<h2 id="org471894b">bash-completion</h2>
<div class="outline-text-2" id="text-org471894b">
<p>
Ok your emacs life is about to level up +1 <a href="https://github.com/szermatt/emacs-bash-completion">bash-completion</a>.
Config:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(use-package bash-completion
  <span style="font-weight: bold;">:init</span> (autoload
          'bash-completion-dynamic-complete
          <span style="font-style: italic;">"bash-completion"</span>
          <span style="font-style: italic;">"BASH completion hook"</span>)
  (add-hook
   'shell-dynamic-complete-functions
   #'bash-completion-dynamic-complete))
</pre>
</div>

<p>
Here are the completions of your shell at the tips of those sweet
coconut oily fingers.
</p>

<p>
Now you can do <code>shell-command</code>
-&gt; Hit that tab while typing <code>git checkout ..</code> a door just
opened.
</p>
</div>
</div>

<div id="outline-container-org1080f14" class="outline-2">
<h2 id="org1080f14">bash completions are now your lever</h2>
<div class="outline-text-2" id="text-org1080f14">
<p>
Now my friends we have entered the realm of harnessing already
existing shell completions directly into our kingdom of emacs where
we cozy and effective.
</p>
</div>

<div id="outline-container-org9dd7195" class="outline-3">
<h3 id="org9dd7195">Babashka tasks</h3>
<div class="outline-text-3" id="text-org9dd7195">
<p>
Babashka tasks are one of the great discoveries of our time,
allowing us to write build tasks in Clojure, with the
development ergonomics of a lisp.
</p>

<p>
The babashka book has <a href="https://book.babashka.org/#_terminal_tab_completion">a section</a> on adding shell completions.
Boom. This is all you need.
Now you can enjoy those babashka tasks completions.
</p>
</div>
</div>
</div>

<div id="outline-container-org9bd9f8a" class="outline-2">
<h2 id="org9bd9f8a">Commands that leverage <code>read-shell-command</code></h2>
<div class="outline-text-2" id="text-org9bd9f8a">
<p>
They use <code>read-shell-command</code>.
Making <code>read-shell-command</code> <b>good</b> will pay off for all these.
</p>
</div>

<div id="outline-container-orgf48fa76" class="outline-3">
<h3 id="orgf48fa76">shell-command</h3>
<div class="outline-text-3" id="text-orgf48fa76">
<p>
Bound to <code>M-!</code>
</p>

<p>
This is the <code>interactive</code> doorway into emacs lisp <code>start-process</code> functionality.
</p>
</div>

<div id="outline-container-org9989cce" class="outline-4">
<h4 id="org9989cce">Here is a nugget:</h4>
<div class="outline-text-4" id="text-org9989cce">
<blockquote>
<p>
With prefix argument, insert the COMMAND's output at point.
</p>
</blockquote>

<p>
<code>C-u M-!</code> <code>date</code> and you have a date inserted in the buffer.
</p>

<p>
Like this:
<code>Thu Sep 29 10:55:44 AM CEST 2022</code>
</p>
</div>
</div>

<div id="outline-container-orgddedf8f" class="outline-4">
<h4 id="orgddedf8f">Good to know:</h4>
<div class="outline-text-4" id="text-orgddedf8f">
<blockquote>
<p>
If COMMAND ends in &amp;, execute it asynchronously.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org54de924" class="outline-4">
<h4 id="org54de924">Output buffer</h4>
<div class="outline-text-4" id="text-org54de924">
<p>
Your command output is located by default in a buffer named by <code>shell-command-buffer-name</code>.
Or <code>shell-command-buffer-name-async</code> when async.
</p>
</div>
</div>
</div>

<div id="outline-container-orgbde0a54" class="outline-3">
<h3 id="orgbde0a54">shell-command-async</h3>
<div class="outline-text-3" id="text-orgbde0a54">
<p>
Bound to <code>M-&amp;</code> and has the same effect as adding a <code>&amp;</code> in <code>shell-command</code>.
To kill the process I can hit <code>C-c C-c</code>.
</p>
</div>
</div>

<div id="outline-container-org744478d" class="outline-3">
<h3 id="org744478d">compile</h3>
<div class="outline-text-3" id="text-org744478d">
<p>
Very useful, very similar to <code>shell-command-async</code>.
Always uses the same buffer called <code>*compilation*</code>.
You can set <code>compile-command</code> for instance via <code>.dir-locals.el</code>, then
it auto makes a compile command in that project.
</p>
</div>
</div>

<div id="outline-container-orgc5c63de" class="outline-3">
<h3 id="orgc5c63de">dired</h3>
<div class="outline-text-3" id="text-orgc5c63de">
<p>
<code>dired-do-shell-command</code> and <code>dired-do-async-shell-command</code>
are symetrical with <code>shell-command</code> and <code>async-shell-command</code>.
Those functions call <code>shell-command</code>.
</p>

<p>
Bound to <code>!</code> and <code>&amp;</code> in dired Docstring is worth reading.
Important to know is that <code>*</code> expands to <code>dired-file-name-at-point</code>,
or the marked files, but is implicit as the last arg.
</p>
</div>
</div>

<div id="outline-container-orgfbcf05c" class="outline-3">
<h3 id="orgfbcf05c">shell-command-on-file</h3>
<div class="outline-text-3" id="text-orgfbcf05c">
<p>
Sometimes you are currently visiting a script file and you just want
to run it.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mm/shell-command-on-file</span> (command)
  <span style="font-style: italic;">"Execute COMMAND asynchronously on the current file."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-shell-command
                      (concat <span style="font-style: italic;">"Async shell command on "</span> (buffer-name) <span style="font-style: italic;">": "</span>))))
  (<span style="font-weight: bold;">let</span> ((filename (<span style="font-weight: bold;">if</span> (equal major-mode 'dired-mode)
                      default-directory
                    (buffer-file-name))))
    (async-shell-command (concat command <span style="font-style: italic;">" "</span> filename))))
</pre>
</div>

<p>
Thanks to <a href="https://github.com/Gavinok/emacs.d">Gavin Freeborn</a> for the initial version of this code.
</p>
</div>
</div>
</div>

<div id="outline-container-org963a79f" class="outline-2">
<h2 id="org963a79f">It gets even better</h2>
<div class="outline-text-2" id="text-org963a79f">
<p>
Let me introduce you to the wonders of <code>revert-buffer-function</code>.
Now, <code>revert-buffer</code> is a powerful command by itself.
</p>

<p>
I did not know this for a while, but you can set the local variable <code>revert-buffer-function</code>.
This pearl is in emacs 28:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">setq-local</span>
 revert-buffer-function
 (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
   (async-shell-command command buffer)))
</pre>
</div>

<p>
You say <code>revert-buffer</code> in a shell command buffer, to boom run the
command again in the same buffer. Exactly what I want sometimes.
A single key to rerun a command. And I think the concepts just fit
nicely. There is no mental burden with this.
</p>
</div>

<div id="outline-container-org7968ce3" class="outline-3">
<h3 id="org7968ce3">revert-buffer in compilation buffers</h3>
<div class="outline-text-3" id="text-org7968ce3">
<div class="org-src-container">
<pre class="src src-elisp">(advice-add
   #'compilation-revert-buffer
   <span style="font-weight: bold;">:filter-args</span>
   (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mm/always-noconfirm-compilation-revert-buffer</span> (args)
     (<span style="font-weight: bold;">pcase</span> args
       (`(,ignore-auto nil) `(,ignore-auto t))
       (_ args))))
</pre>
</div>

<p>
I use <code>revert-buffer</code> as a consenting adult - kill and restart the
compile command, without asking.
</p>
</div>
</div>
</div>


<div id="outline-container-org64cab9a" class="outline-2">
<h2 id="org64cab9a">Scripts at the speed of thought</h2>
<div class="outline-text-2" id="text-org64cab9a">

<div id="org45f8216" class="figure">
<p><img src="https://github.com/benjamin-asdf/faster-than-light-memes/blob/master/assets/insta-script.gif?raw=true" alt="insta-script.gif?raw=true" />
</p>
<p><span class="figure-number">Figure 2: </span>Make a script, and run the script. Leveraging <code>bash-completion</code> in <code>shell-script-mode</code>.</p>
</div>
</div>

<div id="outline-container-orgf48b317" class="outline-3">
<h3 id="orgf48b317">mememacs/create-script</h3>
<div class="outline-text-3" id="text-orgf48b317">
<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mememacs/create-script*</span> (file bang setup)
  (find-file file)
  (insert bang)
  (save-buffer)
  (evil-insert-state)
  (set-file-modes file #o751)
  (funcall setup))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mememacs/create-script</span> (file)
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"Fnew script: "</span>)
  (mememacs/create-script*
   file
   <span style="font-style: italic;">"#!/bin/sh\n"</span>
   #'shell-script-mode))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mememacs/create-bb-script</span> (file)
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"Fnew bb: "</span>)
  (mememacs/create-script*
   file
   <span style="font-style: italic;">"#!/usr/bin/env bb\n"</span>
   #'clojure-mode))
</pre>
</div>

<p>
I have bound these in <code>dired-mode</code>.
Then, I use <code>mm/shell-command-on-file</code> to dev interactively sort of.
</p>

<p>
Btw <code>shell-script-mode</code> becomes a power house when you integrate <a href="https://github.com/koalaman/shellcheck">shellcheck</a>.
<code>flycheck</code> has something for that. (pretty sure <code>flymake</code> should as well.)
Shellcheck makes superb warnings. Firmly in my "adopt" circle.
</p>
</div>

<div id="outline-container-orgbbc8693" class="outline-4">
<h4 id="orgbbc8693">bash-completion in <code>sh-mode</code></h4>
<div class="outline-text-4" id="text-orgbbc8693">
<p>
Here is my full <code>bash-completion</code> config that adds to <code>capf</code>.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(use-package bash-completion
  <span style="font-weight: bold;">:init</span>
  (autoload 'bash-completion-dynamic-complete
    <span style="font-style: italic;">"bash-completion"</span>
    <span style="font-style: italic;">"BASH completion hook"</span>)
  (add-hook 'shell-dynamic-complete-functions
            #'bash-completion-dynamic-complete)

  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">bash-completion-capf-1</span> (bol)
    (bash-completion-dynamic-complete-nocomint (funcall bol) (point) t))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">bash-completion-eshell-capf</span> ()
    (bash-completion-capf-1 (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">save-excursion</span> (eshell-bol) (point)))))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">bash-completion-capf</span> ()
    (bash-completion-capf-1 #'point-at-bol))
  (add-hook
   'sh-mode-hook
   (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mm/add-bash-completion</span> ()
     (add-hook 'completion-at-point-functions #'bash-completion-capf nil t))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orge25b595" class="outline-2">
<h2 id="orge25b595">async-shell-command, my bread and butter</h2>
<div class="outline-text-2" id="text-orge25b595">
<p>
Of these commands, it is the one I use the most.
And really, all the other commands could be performed in terms of it.
Here is some of my journey of smoothing out some edges.
</p>
</div>

<div id="outline-container-orga93ede5" class="outline-3">
<h3 id="orga93ede5">Put the command into the buffer name</h3>
<div class="outline-text-3" id="text-orga93ede5">
<p>
When you run a second command, by default, it tries to reuse the old buffer and asks you
</p>

<div class="org-src-container">
<pre class="src src-elisp">(yes-or-no-p
             (format <span style="font-style: italic;">"A command is running in the default buffer.  %s? "</span>
                     action))
</pre>
</div>

<p>
I put the <code>command</code> into the buffer name so I usually get a unique
buffer name.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mm/put-command-in-async-buff-name</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  (<span style="font-weight: bold;">let*</span> ((path-s (path-slug default-directory))
         (command (car args))
         (buffname (concat path-s <span style="font-style: italic;">" "</span> command))
         (shell-command-buffer-name-async
          (format
           <span style="font-style: italic;">"*async-shell-command %s*"</span>
           (string-trim
            (substring buffname 0 (min (length buffname) 50))))))
    (apply f args)))

(advice-add 'shell-command <span style="font-weight: bold;">:around</span> #'mm/put-command-in-async-buff-name)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">path-slug</span> (dir)
    <span style="font-style: italic;">"Returns the initials of `dir`s path,</span>
<span style="font-style: italic;">with the last part appended fully</span>

<span style="font-style: italic;">Example:</span>

<span style="font-style: italic;">(path-slug \"/foo/bar/hello\")</span>
<span style="font-style: italic;">=&gt; \"f/b/hello\" "</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dash</span>)
    (<span style="font-weight: bold;">let*</span> ((path (replace-regexp-in-string <span style="font-style: italic;">"\\."</span> <span style="font-style: italic;">""</span> dir))
           (path (split-string path <span style="font-style: italic;">"/"</span> t))
           (path-s (mapconcat
                    (<span style="font-weight: bold;">lambda</span> (it)
                      (cl-subseq it 0 1))
                    (-drop-last 1 path)
                    <span style="font-style: italic;">"/"</span>))
           (path-s (concat
                    path-s
                    <span style="font-style: italic;">"/"</span>
                    (-last-item path))))
      path-s))
</pre>
</div>

<p>
Now I can complete buffers and start typing the commands.
And the buffers don't have an anonymous name like <code>*async-shell-command&lt;2&gt;*</code>.
</p>
</div>
</div>

<div id="outline-container-org8a91817" class="outline-3">
<h3 id="org8a91817">shell-command&#x2013;same-buffer-confirm</h3>
<div class="outline-text-3" id="text-org8a91817">
<p>
Sort of a power setting when you do <code>async-shell-command</code> a lot.
I used to have this to <code>'confirm-kill-process</code>
Now I do
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">setf</span> async-shell-command-buffer 'new-buffer)
</pre>
</div>

<p>
If I want to kill I can do <code>C-c C-c</code> on the old buffer.
</p>
</div>
</div>

<div id="outline-container-org26ed96c" class="outline-3">
<h3 id="org26ed96c">shell-mode as a terminal emulator</h3>
<div class="outline-text-3" id="text-org26ed96c">
<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mm/shell-via-async-shell-command</span> ()
    (switch-to-buffer
     (window-buffer
      (async-shell-command
       shell-file-name))))
</pre>
</div>

<p>
You get a shell buffer running your shell.
Does everything I need from a terminal.
It pays of having a minimal <code>.rc</code> file. This is also why I have
<code>shell-file-name</code> set to "/bin/bash".
Even though I have a cool zsh config with vi mode.
I get all the evil stuff for free in <code>shell</code> buffers.
</p>
</div>
</div>
</div>

<div id="outline-container-org0989d1c" class="outline-2">
<h2 id="org0989d1c">process-list</h2>
<div class="outline-text-2" id="text-org0989d1c">
<p>
You get a list of all current processes.
Here is a function I have bound in <code>process-menu-mode-map</code> :
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mememacs/process-menu-switch-to-buffer</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when-let*</span>
      ((id (tabulated-list-get-id))
       (b (process-buffer id)))
    (switch-to-buffer b)))
</pre>
</div>

<p>
Nice, a way to easily get to the buffer again when looking at <code>process-list</code>.
</p>

<p>
Similarly useful is doing <code>ibuffer</code> then <code>s m</code> <code>ibuffer-filter-by-used-mode</code> -&gt; <code>shell</code>.
Nice, an ibuffer list of shell procs.
</p>

<p>
With <code>embark</code> I can also do <code>consult-buffer</code> -&gt; <code>b</code> to narrow -&gt; type
<code>async</code> -&gt; <code>embark-export</code>.
Hehe, a nice <code>ibuffer</code> of all my shell commands.
</p>

<p>
If you don't know <code>ibuffer</code>, but you know <code>dired</code>.
Then you know <code>ibuffer</code>. They are analogous by design.
</p>
</div>
</div>

<div id="outline-container-org66ffacd" class="outline-2">
<h2 id="org66ffacd">The next layer on the cake</h2>
<div class="outline-text-2" id="text-org66ffacd">
<p>
More context for <code>shell-command</code>.
</p>
</div>

<div id="outline-container-org5b91295" class="outline-3">
<h3 id="org5b91295">project</h3>
<div class="outline-text-3" id="text-org5b91295">
<p>
I use <code>project.el</code>. <code>project-compile</code>  runs <code>compile</code> in the project root. Analogously, there is <code>project-async-shell-command</code>.
<code>projectile</code>, a big and widely used package, provides similar commands.
</p>
</div>
</div>

<div id="outline-container-org5a4a514" class="outline-3">
<h3 id="org5a4a514">recompile</h3>
<div class="outline-text-3" id="text-org5a4a514">
<p>
Similar to going to the <code>*compilation*</code> buffer and <code>revert-buffer</code>.
But a single command.
</p>
</div>
</div>

<div id="outline-container-org105944e" class="outline-3">
<h3 id="org105944e">ansi colors for comint</h3>
<div class="outline-text-3" id="text-org105944e">
<p>
If you use <a href="https://github.com/lambdaisland/kaocha">Koacha</a> together with <code>compile</code>,
you will get output sprinkled with ANSI (color) escape codes.
</p>

<p>
Bit cluttering on the eyes.
</p>

<p>
I knew from earlier dabblings that there is a package called <code>ansi-color</code>.
So I checked around on how to make my buffer colored nicely.
</p>

<p>
Turns out that <code>comint</code> already has <code>ansi-color-compilation-filter</code> setup by default.
Checking the code for <code>compile</code> I see that with prefix arg, the buffer
becomes a comint buffer.
So I decided I always make my compile buffers comint buffers.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(advice-add
   'compile
   <span style="font-weight: bold;">:filter-args</span>
   (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mm/always-use-comint-for-compile</span> (args)
     `(,(car args) t)))
</pre>
</div>

<p>
Koacha output looks like this:
</p>


<div id="orgd041702" class="figure">
<p><img src="https://i.imgur.com/5vpmnsu.png" alt="5vpmnsu.png" />
</p>
<p><span class="figure-number">Figure 3: </span>A <code>compile</code> buffer running <code>Koacha</code> with pleasing green colored output text.</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc50e828" class="outline-2">
<h2 id="orgc50e828">Levers are great</h2>
<div class="outline-text-2" id="text-orgc50e828">
</div>
<div id="outline-container-orgab6be3f" class="outline-3">
<h3 id="orgab6be3f">ssh</h3>
<div class="outline-text-3" id="text-orgab6be3f">
<p>
Nice tip in case you did not know:
You can define preset configs in <code>~/.ssh/config</code> and they will show up
as bash completions when you type <code>ssh</code>  and hit tap.
</p>

<div class="org-src-container">
<pre class="src src-shell">Host dotomic-system-ec2
     HostName ...
     ...
</pre>
</div>

<p>
So now I just type <code>M-&amp;</code> for <code>async-shell-command</code>, then <code>ssh</code>, then
I hit tap and I get <code>dotomic-system-ec2</code> as completion. Yes!
</p>
</div>
</div>

<div id="outline-container-org09ecc54" class="outline-3">
<h3 id="org09ecc54">embarking</h3>
<div class="outline-text-3" id="text-org09ecc54">
<p>
Through <a href="https://github.com/oantolin/embark">embark</a> the power of completions is further amplified.
For instance, I can complete git branches via <code>git checkout</code> completions.
</p>


<div id="org163a59e" class="figure">
<p><img src="https://github.com/benjamin-asdf/faster-than-light-memes/blob/master/assets/embarking-git-branches.gif?raw=true" alt="embarking-git-branches.gif?raw=true" />
</p>
<p><span class="figure-number">Figure 4: </span>Abusing <code>read-shell-command</code> to dispatch with <code>embark</code> on git checkout completions. Invoking <code>embark-insert</code> as an example.</p>
</div>
</div>
</div>

<div id="outline-container-org485419e" class="outline-3">
<h3 id="org485419e">pass</h3>
<div class="outline-text-3" id="text-org485419e">
<p>
Another example. I used to use <a href="https://github.com/emacs-helm/helm-pass/blob/master/helm-pass.el">helm-pass</a> for <code>pass</code>.
Guess what, <code>pass</code> has great shell completions.
I get a free interface to <code>pass</code> just with <code>async-shell-command</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-org5dd7d30" class="outline-2">
<h2 id="org5dd7d30">Particulars</h2>
<div class="outline-text-2" id="text-org5dd7d30">
</div>
<div id="outline-container-orgd858532" class="outline-3">
<h3 id="orgd858532">shell-file-name</h3>
<div class="outline-text-3" id="text-orgd858532">
<p>
It matters.
For instance, if you use "/bin/bash" and you set up your path in a <code>zshrc</code> that might be a pitfall.
Another thing that happened to me was that <a href="https://www.funtoo.org/Funtoo:Keychain">keychain</a> was prompting for my ssh password inside the <code>bash-completion</code> process, making it hang.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-09-22 Thu 12:32</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2)</p>
</div>
</body>
</html>
]]>
    </content>
  </entry>
  <entry>
    <id>https://benjamin-asdf.github.io/faster-than-light-memes/binaural-beats-using-scittle.html</id>
    <link href="https://benjamin-asdf.github.io/faster-than-light-memes/binaural-beats-using-scittle.html"/>
    <title>binaural-beats-using-scittle</title>
    <updated>2022-09-19T23:59:59+00:00</updated>
    <content type="html">
      <![CDATA[<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>binaural-beats-using-scittle</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">binaural-beats-using-scittle</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgab746f8">Introduction</a>
<ul>
<li><a href="#org0824298">What are binaural beats?</a></li>
<li><a href="#org981cb89">Science</a></li>
<li><a href="#org076161f">Frequency</a></li>
<li><a href="#orgcddc69d">The neuroscience of the auditory system </a></li>
<li><a href="#org924cc89">I think this is ultra cool</a></li>
<li><a href="#org26d0e3d">Give me those binaural beats</a>
<ul>
<li><a href="#org0001b20">The problem statement:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfe55e12">scittle</a>
<ul>
<li><a href="#orga513183">1 ear, 1 sound</a>
<ul>
<li><a href="#orga761423">The first playground</a></li>
</ul>
</li>
<li><a href="#org58bd08a">Playing Hz, first round</a></li>
</ul>
</li>
<li><a href="#org1b9d1b7">binaural!</a>
<ul>
<li><a href="#orge17e76f">just put the second sound in the other ear, whatever</a></li>
</ul>
</li>
<li><a href="#orgab7dd09">Intermediate results</a>
<ul>
<li><a href="#org6773a28">Artifacts</a></li>
<li><a href="#org9861b13">Binaural beat?</a></li>
</ul>
</li>
<li><a href="#org87096aa">Change the base frequency</a>
<ul>
<li><a href="#org98df10d">I really need a slider for frequencies in my life.</a>
<ul>
<li><a href="#orgb8f8e87">nice dev experience, scittle really</a></li>
<li><a href="#org952052d">code:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgbde39b4">Notes</a>
<ul>
<li><a href="#orgd6a79c0">Images</a></li>
<li><a href="#org11e5164">Update 1</a></li>
<li><a href="#orga79e297">Update 2</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgab746f8" class="outline-2">
<h2 id="orgab746f8">Introduction</h2>
<div class="outline-text-2" id="text-orgab746f8">
<p>
The best thing about being a rationalist is figuring out you are wrong
about something.
</p>

<p>
I was thinking that <code>binaural beats</code> belong together with astral travel,
frankly, just down the toilet.
Turns out that not only was I wrong, but binaural beats also have cool
neuroscience and pose a fun engineering problem on top of that!
</p>

<p>
<a href="https://benjamin-asdf.github.io/just-40hz-binaural-beats/">Here</a> is the current result of my journeys up on gh-pages.
</p>
</div>

<div id="outline-container-org0824298" class="outline-3">
<h3 id="org0824298">What are binaural beats?</h3>
<div class="outline-text-3" id="text-org0824298">
<p>
<a href="https://simple.wikipedia.org/wiki/Binaural_beats">Wikipedia</a>
</p>

<blockquote>
<p>
A binaural beat is an auditory illusion
</p>
</blockquote>

<blockquote>
<p>
For example, if a 530 Hz pure tone is presented to a subject's right ear, while a 520 Hz pure tone is presented to the subject's left ear, the listener will perceive the illusion of a third tone. The third sound is called a binaural beat, and in this example would have a perceived pitch correlating to a frequency of 10 Hz, that being the difference between the 530 Hz and 520 Hz pure tones presented to each ear.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org981cb89" class="outline-3">
<h3 id="org981cb89">Science</h3>
<div class="outline-text-3" id="text-org981cb89">
<p>
There has developed a <a href="https://pubmed.ncbi.nlm.nih.gov/30073406/">growing science</a> about improvements in memory and
attention tasks when listening to binaural beats.
</p>

<p>
BTW the frequency and the time of the exposure matter (i.e. before and during the task is best).
</p>

<p>
Oh yes, I certainly want more of that memory and attention.
</p>


<div id="org7af57d9" class="figure">
<p><img src="https://i.imgur.com/eHaaoYF.png" alt="eHaaoYF.png" />
</p>
<p><span class="figure-number">Figure 1: </span>A brain with headphones flying at the speed of light through space. Lightning on the brain. There is a sine wave in the background. Stylized, Colorful, Cinematic, Digital Art.</p>
</div>
</div>
</div>


<div id="outline-container-org076161f" class="outline-3">
<h3 id="org076161f">Frequency</h3>
<div class="outline-text-3" id="text-org076161f">
<p>
Theta waves (5Hz) <a href="https://pubmed.ncbi.nlm.nih.gov/29222722/">actually decrease memory task performance</a>. So I
really do not want to listen to those.
I heard <a href="https://hubermanlab.com/the-science-of-hearing-balance-and-accelerated-learning/">Andrew Huberman</a> saying that <b>40Hz</b> is the most powerful.
</p>

<p>
If you know about <a href="https://en.wikipedia.org/wiki/Neural_oscillation">brain waves</a>, you might remember 40Hz as the
legendarily intriguing gamma wave.
</p>

<p>
From <a href="https://en.wikipedia.org/wiki/Gamma_wave">wikipedia article</a>:
</p>

<blockquote>
<p>
Gamma rhythms are correlated with large scale brain network activity and cognitive phenomena such as working memory, attention, and perceptual grouping, and can be increased in amplitude via meditation or neurostimulation.
</p>
</blockquote>

<p>
We are really talking about cool stuff here, attention, working
memory, and memory processes. Also, the <a href="https://en.wikipedia.org/wiki/Binding_problem">Binding problem</a>.
</p>
</div>
</div>

<div id="outline-container-orgcddc69d" class="outline-3">
<h3 id="orgcddc69d">The neuroscience of the <a href="https://en.wikipedia.org/wiki/Hearing">auditory system </a></h3>
<div class="outline-text-3" id="text-orgcddc69d">
<p>
Hearing is cool because the neuronal neural information first goes into the brainstem
and then goes up some nuclei up to the thalamus. And eventually to the
temporal lobes of the cortex (the 2 arm things on the side of the brain).
</p>

<p>
This is different from the vision system where the info goes directly to the thalamus.
</p>

<p>
Quoting this <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7082494/">paper</a>:
</p>

<blockquote>
<p>
Presenting two tones with a slight frequency mismatch to each ear separately creates a perception of a third tone, a binaural beat, that oscillates at the absolute difference between the tones (Oster, 1973; Moore, 2012). These beats are thought to originate subcortically in the medial nucleus of the superior olivary complex, the first nucleus in the auditory pathway to receive bilateral input (Wernick and Starr, 1968; Kuwada et al., 1979). This illusory third tone is lateralized between the left and right ear of the listener, making binaural beats useful for spatial sound research (Ross et al., 2014).
</p>
</blockquote>

<p>
from the Wikipedia articles on <a href="https://en.wikipedia.org/wiki/Sound_localization">Sound localization</a>
</p>

<blockquote>
<p>
The auditory system uses several cues for sound source localization, including time difference and level difference (or intensity difference) between the ears, and spectral information.
</p>
</blockquote>

<p>
and <a href="https://en.wikipedia.org/wiki/Superior_olivary_complex">Superior olivary complex</a>
</p>

<blockquote>
<p>
The superior olivary nucleus plays a number of roles in hearing. The medial superior olive (MSO) is a specialized nucleus that is believed to measure the time difference of arrival of sounds between the ears (the interaural time difference or ITD). The ITD is a major cue for determining the azimuth of sounds, i.e., localizing them on the azimuthal plane  their degree to the left or the right.
</p>
</blockquote>

<p>
So there is sort of a clump of neurons in the brainstem that are specialized to integrate the timing information between the left and the right ear.
I'm guessing those then start firing in the 40Hz frequency and that is interpreted as a third sound higher up.
</p>
</div>
</div>

<div id="outline-container-org924cc89" class="outline-3">
<h3 id="org924cc89">I think this is ultra cool</h3>
<div class="outline-text-3" id="text-org924cc89">
<p>
You throw some energy at the brain in the right form (in this case
some sound waves) and it reacts in some special way.
If you put it like that, it is not surprising that some things
eventually, end up doing <b>something</b>.
</p>

<p>
Now that the phenomenon has a name we can talk about it, similar to <a href="https://en.wikipedia.org/wiki/ASMR">ASMR</a>.
</p>

<p>
Thinking about how this was always part of how the brain works.
Makes me wonder if some music composers and performers implicitly hit on this earlier, or not.
I tried searching the web for
</p>

<blockquote>
<p>
binaural beats in music
</p>
</blockquote>

<p>
but I really get the same results mix as when I search for <code>binaural beats</code>.
</p>
</div>
</div>


<div id="outline-container-org26d0e3d" class="outline-3">
<h3 id="org26d0e3d">Give me those binaural beats</h3>
<div class="outline-text-3" id="text-org26d0e3d">
<p>
I dint feel like opening a youtube video just to listen to some
sounds. As an aspiring hacker and engineer, I just want to make my
computer make some sounds that I want to listen to.
So I decided to make a simple website that just makes binaural beats and nothing else.
</p>
</div>

<div id="outline-container-org0001b20" class="outline-4">
<h4 id="org0001b20">The problem statement:</h4>
<div class="outline-text-4" id="text-org0001b20">
<p>
Make a sound on 1 ear (e.g. left headphone speaker)
</p>

<p>
Make a second sound on the other ear, with a +40Hz frequency.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfe55e12" class="outline-2">
<h2 id="orgfe55e12">scittle</h2>
<div class="outline-text-2" id="text-orgfe55e12">
<p>
I set up a beautiful hello world <a href="https://github.com/babashka/scittle/tree/main/doc/nrepl">and connect with nrepl</a>
and get greeted with a friendly <code>Isn't cool? this :)</code>.
</p>

<p>
It took me a moment to figure out I should open my index.html with a browser.
Then do the <code>cider-connect-cljs</code>
</p>
</div>

<div id="outline-container-orga513183" class="outline-3">
<h3 id="orga513183">1 ear, 1 sound</h3>
<div class="outline-text-3" id="text-orga513183">
<p>
First I think let's start making a sound in 1 ear.
</p>

<p>
I am thinking a frequency that I can hear would be nice
so I search the web for <a href="https://en.wikipedia.org/wiki/Hearing_range">human auditory frequencies</a>
</p>

<p>
1 kHz sounds like a good first thing to try.
I am figuring something inside the speech area should sound natural
(turned out that was a naive assumption).
</p>
</div>

<div id="outline-container-orga761423" class="outline-4">
<h4 id="orga761423">The first playground</h4>
<div class="outline-text-4" id="text-orga761423">
<p>
I have a file called playground.clj
(Later I figured out I should rename to .cljs :) ).
</p>

<p>
Now getting heavily inspired by <a href="https://github.com/Cortexelus/Polyphonic-Binaural-Beats">this code</a>.
Going 1 form by 1 like a usual lisp interaction dev experience, lulling it up:
</p>

<div class="org-src-container">
<pre class="src src-Clojure">(def ctx (js/window.AudioContext.))
(def ctx js/window.webkitAudioContext)

(def panner (ctx.createStereoPanner))
(set! (.. panner -pan -value) -1)
(.. panner (connect ctx.destination))

(def oscillators (atom []))
(let [o (ctx.createOscillator)
      _ (set! (.- o type) "sine")
      _ (set! (.. o -frequency -value) 1000)]
  (. o start)
  (. o (connect panner))
  (swap! oscillators conj o))
</pre>
</div>

<p>
I connect my headphones via Bluetooth (a small feat on Linux, maybe
another blog post), and lo and behold I hear a tone in my left ear.
It is a really obnoxious sound, after a few seconds, it is so painful
that I move the headphone to the side.
</p>
</div>
</div>
</div>

<div id="outline-container-org58bd08a" class="outline-3">
<h3 id="org58bd08a">Playing Hz, first round</h3>
<div class="outline-text-3" id="text-org58bd08a">
<p>
Here is a more endurable sound:
</p>

<div class="org-src-container">
<pre class="src src-Clojure">(set! (.. (@oscillators 0) -frequency -value) 200)
</pre>
</div>

<p>
Playing around live at the REPL with sound is <b>fun</b>!
</p>

<p>
Now I am thinking, let's pick some music frequency, those are supposed
to be crafted over hundreds of years to be beautiful frequencies, right?
</p>

<p>
Checking out <a href="https://pages.mtu.edu/~suits/notefreq432.html">a website</a>. I pick D#3 / Eb3. Whatever that is.
</p>

<div class="org-src-container">
<pre class="src src-Clojure">(def a-note-freq 152.74)
(set! (.. (@oscillators 0) -frequency -value) a-note-freq)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org1b9d1b7" class="outline-2">
<h2 id="org1b9d1b7">binaural!</h2>
<div class="outline-text-2" id="text-org1b9d1b7">
<p>
Let's do the thing where I add +40Hz and play that on the other ear.
First I start generalizing how I make a panner:
</p>

<div class="org-src-container">
<pre class="src src-Clojure">(defn -&gt;panner [ctx left?]
  (let
      [panner (. ctx createStereoPanner)
       _ (set! (.. panner -pan -value) (if left? -1 1))
       _ (.. panner (connect ctx.destination))]
    panner))
</pre>
</div>

<p>
For some reason running this I get:
</p>

<pre class="example" id="orgd22ae3b">
Failed to execute 'connect' on 'AudioNode': Overload resolution failed.
</pre>

<p>
I went and asked in the nbb clojurians slack. I am sure one day we will figure out
this error, in the meantime&#x2026;
</p>
</div>

<div id="outline-container-orge17e76f" class="outline-3">
<h3 id="orge17e76f">just put the second sound in the other ear, whatever</h3>
<div class="outline-text-3" id="text-orge17e76f">
<div class="org-src-container">
<pre class="src src-Clojure">(ns beats)

(def a-note-freq 152.74)
(def binaural-beat-freq 40)
(def oscillators (atom []))
(defonce ctx (js/window.AudioContext.))

(def panners
  {:left
   (let [left? true]
     (let [panner (. ctx createStereoPanner)]
       (set! (.. panner -pan -value) (if left? -1 1))
       (.connect panner ctx.destination)
       panner))
   :right
   (let [left? nil]
     (let [panner (. ctx createStereoPanner)]
       (set! (.. panner -pan -value) (if left? -1 1))
       (.connect panner ctx.destination)
       panner))})

(defn oscillate [panner hz]
  (let [o (ctx.createOscillator)
	_ (set! (.- o type) "sine")
	_ (set! (.. o -frequency -value) hz)]
    (. o start)
    (. o (connect panner))
    (swap! oscillators conj o)))

(-&gt; panners :right (oscillate (+ a-note-freq binaural-beat-freq)))
(-&gt; panners :left (oscillate a-note-freq))
</pre>
</div>

<p>
lol, it works.
</p>
</div>
</div>
</div>

<div id="outline-container-orgab7dd09" class="outline-2">
<h2 id="orgab7dd09">Intermediate results</h2>
<div class="outline-text-2" id="text-orgab7dd09">
</div>
<div id="outline-container-org6773a28" class="outline-3">
<h3 id="org6773a28">Artifacts</h3>
<div class="outline-text-3" id="text-org6773a28">
<p>
Every now and then there are artifacts in the sound with my headphones setup.
Some are just rustling and crackling.
</p>

<p>
Others sound like some kind of metal being stretched far, far away, underwater, or in slow motion.
It reminds me a bit of the <a href="https://www.youtube.com/watch?v=O6iHgOEp0Fg&amp;t=452s">Dungeon Keeper soundtrack</a>. Dark and eerie,
sort of slow mow.
</p>
</div>
</div>

<div id="outline-container-org9861b13" class="outline-3">
<h3 id="org9861b13">Binaural beat?</h3>
<div class="outline-text-3" id="text-org9861b13">
<p>
Pretty sure I get the third-tone illusion.
I would describe it as some kind of background or in between "airy"
sound.
It is supposed to seem to come from the middle of the brain.
It is as if the fabric of the sound is richer. Like there is sound in more places.
</p>
</div>
</div>
</div>

<div id="outline-container-org87096aa" class="outline-2">
<h2 id="org87096aa">Change the base frequency</h2>
<div class="outline-text-2" id="text-org87096aa">
<p>
It occurred to me, that if I get the 40Hz sound illusion, then I would
predict that I can change the base frequency, keeping the 40Hz difference between
left and right ear invariant. I should then constantly perceive a 3rd tone which is the binaural beat.
</p>
</div>

<div id="outline-container-org98df10d" class="outline-3">
<h3 id="org98df10d">I really need a slider for frequencies in my life.</h3>
<div class="outline-text-3" id="text-org98df10d">
<p>
I did not do much web dev in my life and making a slider was a first.
</p>

<p>
I managed to put something together, drawing inspiration from
<a href="https://www.w3schools.com/howto/howto_js_rangeslider.asp">w3 schools</a> for the Html, <a href="https://babashka.org/scittle/">scittle</a> for how to export, and <a href="https://stackoverflow.com/questions/13896685/html5-slider-with-onchange-function">stackoverflow</a> for how to add a function to "onchange".
</p>
</div>

<div id="outline-container-orgb8f8e87" class="outline-4">
<h4 id="orgb8f8e87">nice dev experience, scittle really</h4>
<div class="outline-text-4" id="text-orgb8f8e87">
<ol class="org-ol">
<li>I did not need to restart my REPL at any point, adding those Html
elements, then reloading my index.html - it handles that.</li>
<li><p>
I get auto completions with cider. E.g. <code>js/..</code> does something.
</p>

<div class="org-center">
<p>
BTW here is a tip, for <code>sci</code> projects (<code>babashka</code>, <code>nbb</code>, <code>scittle</code>).
Currently, you need to evaluate a namespace form first.
Then you can get completions.
At least with cider.
</p>
</div></li>
</ol>



<div id="org9b2c5e4" class="figure">
<p><img src="https://i.imgur.com/M8rSuZ3.png" alt="M8rSuZ3.png" />
</p>
<p><span class="figure-number">Figure 2: </span>A mouse with headphones typing on a laptop. Intelligent. Sparks of magic are flying around. There is lightning on the mouse and laptop. Computer programming source code. Colorful, playful.</p>
</div>

<p>
The word <code>scittle</code> makes me think of a small mammal in the habitus of
a mouse.
I imagine it scurrying and curiously sniffing around.
</p>
</div>
</div>

<div id="outline-container-org952052d" class="outline-4">
<h4 id="org952052d">code:</h4>
<div class="outline-text-4" id="text-org952052d">
<p>
index.html
</p>
<div class="org-src-container">
<pre class="src src-Html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;script&gt;var SCITTLE_NREPL_WEBSOCKET_PORT = 1340;&lt;/script&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/scittle@0.3.10/dist/scittle.js" type="application/javascript"&gt;&lt;/script&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/scittle@0.3.10/dist/scittle.nrepl.js" type="application/javascript"&gt;&lt;/script&gt;
    &lt;script type="application/x-scittle" src="beats.cljs"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class="slidecontainer"&gt;
      &lt;input type="range" min="120000" max="250000" value="15274"
      class="slider" id="frequencyRange" onchange="update_app(this.value)"&gt; &lt;/div&gt;
    &lt;div id="frequencyDisplay"&gt; &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>

<p>
beats.cljs
</p>
<div class="org-src-container">
<pre class="src src-clojure">(ns beats)

(def binaural-beat-freq 40)
(defonce ctx (js/window.AudioContext.))
(def slider (js/document.getElementById "frequencyRange"))
(def display (js/document.getElementById "frequencyDisplay"))

(def panners
  {:left
   (let [left? true]
     (let [panner (. ctx createStereoPanner)]
       (set! (.. panner -pan -value) (if left? -1 1))
       (.connect panner ctx.destination)
       panner))
   :right
   (let [left? nil]
     (let [panner (. ctx createStereoPanner)]
       (set! (.. panner -pan -value) (if left? -1 1))
       (.connect panner ctx.destination)
       panner))})

(defn update-display! [value]
  (set! (.-innerHTML display)
	(str "Base frequency: " value)))

(def get-oscillator
  (memoize
   (fn [panner]
     (let [o (ctx.createOscillator)]
       (set! (.- o type) "sine")
       (. o start)
       (. o (connect panner))
       o))))

(defn oscillate [panner hz]
  (let [o (get-oscillator panner)
	_ (set! (.. o -frequency -value) hz)])
  hz)

(defn update-app [frequency-value]
  (let [frequency-value (/ frequency-value 1000.0)]
    (-&gt; panners :right (oscillate (+ frequency-value binaural-beat-freq)))
    (-&gt; panners :left (oscillate frequency-value))
    (update-display! frequency-value)))

(set! (.-update_app js/window) update-app)

(update-app (* 1000 152.74))
</pre>
</div>

<p>
The fact that I export my function by setting this global <code>window</code> object is quite wild.
And then how I write a string of js code in the 'onchange' of the
Html - damn.
As I said, I am new to the web. Now I know one reason why it is called the wild west.
But it let me "just do" what I wanted without being in my way so I
appreciate that.
</p>

<p>
On the scittle side, I updated the code to only get 1 oscillator per slider. Seems like stuff is working.
Switching up the frequencies via the slider is satisfying.
For some reason, those artifacts are also gone. Maybe sliders just ensure balance and harmony in the world?
</p>

<p>
I am pretty sure I can tell there is 1 sound that seems to stay the same across frequencies.
</p>

<p>
I do the float <code>* 1000</code> trick because I want to work with 2 digits for my frequencies.
</p>

<p>
Btw I also quickly tried what a <b>real</b> 40Hz tone sounds like. Ultra-low. I almost feel like I can make out the single waves, maybe that
are the headphones cracking?
Not surprising as the lower bound of human hearing is 20hz.
The sound of the highest achievement of human thought.
Genius insights, ideas that come to you like lightning. Globally
integrating patterns of the brain and mind.
</p>


<div id="orgd216bdd" class="figure">
<p><img src="https://i.imgur.com/xijojsT.png" alt="xijojsT.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Harry potter wearing headphones having spiritual enlightenment about magic. Glowing magic sparks fly around. Colorful, cinematic, video game concept art.</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbde39b4" class="outline-2">
<h2 id="orgbde39b4">Notes</h2>
<div class="outline-text-2" id="text-orgbde39b4">
</div>
<div id="outline-container-orgd6a79c0" class="outline-3">
<h3 id="orgd6a79c0">Images</h3>
<div class="outline-text-3" id="text-orgd6a79c0">
<p>
Made with <a href="https://huggingface.co/spaces/stabilityai/stable-diffusion">stable-diffusion</a>.
The captions are the prompts I used.
</p>
</div>
</div>

<div id="outline-container-org11e5164" class="outline-3">
<h3 id="org11e5164">Update 1</h3>
<div class="outline-text-3" id="text-org11e5164">
<p>
Currently does not work on mobile. Seems like I have the
opportunity for another web dev feat, then.
Seems like the issue is isolated on the sound appearing because the
slider value works fine (meaning that the scittle code is running fine).
</p>
</div>
</div>

<div id="outline-container-orga79e297" class="outline-3">
<h3 id="orga79e297">Update 2</h3>
<div class="outline-text-3" id="text-orga79e297">
<p>
Now it also works on mobile!
Somebody helpfully pointed out on slack that on mac there was an error
about audio refusing to play before the first touch event.
I fixed that by adding a <code>play</code> button.
But mobile still did not work, ok.
After checking <a href="https://stackoverflow.com/questions/46345883/why-audio-not-playing-on-mobile-browser">stackoverflow</a> I still sort of have the idea that it has
to do with user interaction events and this <code>AudioContext</code>.
I first wanted to delay the whole audio setup until you click the
button.
But <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext">read</a> that you should make a single <code>AudioContext</code> at the beginning.
</p>

<p>
So I try to delay the 1 other thing in the code:
</p>

<div class="org-src-container">
<pre class="src src-clojure">(def panners
 (delay {:left (-&gt;panner true) :right (-&gt;panner false)}))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-clojure">(-&gt; @panners :right (oscillate (+ frequency-value binaural-beat-freq)))
(-&gt; @panners :left (oscillate frequency-value))
</pre>
</div>


<p>
It works, haha!
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-09-19 Mon 11:04</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2)</p>
</div>
</body>
</html>
]]>
    </content>
  </entry>
  <entry>
    <id>https://benjamin-asdf.github.io/faster-than-light-memes/intro-to-clojure.html</id>
    <link href="https://benjamin-asdf.github.io/faster-than-light-memes/intro-to-clojure.html"/>
    <title>intro-to-clojure</title>
    <updated>2022-09-12T23:59:59+00:00</updated>
    <content type="html">
      <![CDATA[<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>intro-to-clojure</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">intro-to-clojure</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org28d32ae">Introduction</a></li>
<li><a href="#org93db6bd">A dev environment</a>
<ul>
<li><a href="#org09d5cde">Vs Code</a></li>
<li><a href="#orgd0ffee9">Emacs</a></li>
</ul>
</li>
<li><a href="#org81c94fc">Nr 1 book for beginners</a></li>
<li><a href="#org408d4db">Slack</a></li>
<li><a href="#org2d6263c">Other such lists</a></li>
</ul>
</div>
</div>

<div id="outline-container-org28d32ae" class="outline-2">
<h2 id="org28d32ae">Introduction</h2>
<div class="outline-text-2" id="text-org28d32ae">
<p>
Clojure is a modern, functional lisp with a fiercely convinced community and
production orientation.
</p>
</div>
</div>

<div id="outline-container-org93db6bd" class="outline-2">
<h2 id="org93db6bd">A dev environment</h2>
<div class="outline-text-2" id="text-org93db6bd">
<p>
Get prepared for your journey as a pilot of an alien spaceship.
As a beginner I suggest either
</p>
</div>

<div id="outline-container-org09d5cde" class="outline-3">
<h3 id="org09d5cde">Vs Code</h3>
<div class="outline-text-3" id="text-org09d5cde">
<p>
Easy to make work. A great editor. You will not need to be ashamed of
your choice. <a href="https://calva.io/getting-started/">calva for vscode</a>
</p>
</div>
</div>

<div id="outline-container-orgd0ffee9" class="outline-3">
<h3 id="orgd0ffee9">Emacs</h3>
<div class="outline-text-3" id="text-orgd0ffee9">
<p>
Strong affinity to hacker culture and a program that is more than a
tool, but eventually an extension to your hands, heart, and mind.
</p>

<p>
Here is a config file I tried to make for beginners:
<a href="https://github.com/benjamin-asdf/simple-easy-emacs">https://github.com/benjamin-asdf/simple-easy-emacs</a>
</p>

<p>
A framework by clojurians that might be just right for you:
<a href="https://github.com/corgi-emacs/corgi">https://github.com/corgi-emacs/corgi</a>
</p>

<p>
There is also doom and spacemacs that enjoy wide appraisal for their
"out of the box" experience.
</p>
</div>
</div>
</div>

<div id="outline-container-org81c94fc" class="outline-2">
<h2 id="org81c94fc">Nr 1 book for beginners</h2>
<div class="outline-text-2" id="text-org81c94fc">
<p>
<a href="https://www.braveclojure.com/clojure-for-the-brave-and-true/">Clojure for the Brave and True</a>
</p>
</div>
</div>

<div id="outline-container-org408d4db" class="outline-2">
<h2 id="org408d4db">Slack</h2>
<div class="outline-text-2" id="text-org408d4db">
<p>
Meet nice people that are excited about the tech <a href="https://clojurians.slack.com/?redir">on slack</a>.
Seriously a lot of people hang there and answer beginner questions,
everybody is welcome.
</p>
</div>
</div>

<div id="outline-container-org2d6263c" class="outline-2">
<h2 id="org2d6263c">Other such lists</h2>
<div class="outline-text-2" id="text-org2d6263c">
<p>
Carin is cool and has a funny picture of the emacs learning curve here:
<a href="https://howistart.org/posts/clojure/1/">https://howistart.org/posts/clojure/1/</a>
</p>

<p>
I like that they have a philosophy section mentioning Rich Hickey's talks
this matters a lot to clojurians.
</p>

<p>
<a href="https://thoughtbot.com/blog/tips-for-clojure-beginners">https://thoughtbot.com/blog/tips-for-clojure-beginners</a>
<a href="https://gist.github.com/yogthos/be323be0361c589570a6da4ccc85f58f">https://gist.github.com/yogthos/be323be0361c589570a6da4ccc85f58f</a>
<a href="https://www.clojurenewbieguide.com/">https://www.clojurenewbieguide.com/</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-09-12 Mon 20:23</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.2)</p>
</div>
</body>
</html>
]]>
    </content>
  </entry>
</feed>
